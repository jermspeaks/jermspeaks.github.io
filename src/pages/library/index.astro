---
import { getCollection } from "astro:content";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../consts";
import BaseBody from "../../components/BaseBody.astro";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Header from "../../components/Header.astro";

const library = (await getCollection("library")).sort(
  (a, b) => b.data.dateConsumed.valueOf() - a.data.dateConsumed.valueOf()
);
const posts = (await getCollection("blog")).filter((post) => !post.data.draft);
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <BaseBody>
    <Header />
    <main>
      <h2 class="text-2xl mb-5 dark:text-white">Library</h2>
      <section>
        <ul class="flex flex-wrap list-none p-0 gap-4">
          {
            library.map((book) => (
              <li class="flex flex-shrink-0 flex-grow-0 flex-col flex-[200px] rounded-sm box-border dark:text-white">
                <a
                  class="visited:text-purple-600"
                  href={book.data.link}
                  target="_blank"
                >
                  <img src={book.data.heroImage} width="200" />
                </a>
                <div class="py-3 px-4 border-t-2 border-solid border-gray-100 mt-4">
                  <div>{book.data.title}</div>
                  <div>{book.data.author}</div>
                  <FormattedDate
                    class="italic text-slate-600 dark:text-slate-300"
                    date={book.data.dateConsumed}
                  />
                  {posts.findIndex(
                    (post) => post.data.title === book.data.review
                  ) > -1 && (
                    <div>
                      <a
                        class="visited:text-purple-600"
                        href={`/blog/${
                          posts[
                            posts.findIndex(
                              (post) => post.data.title === book.data.review
                            )
                          ].slug
                        }`}
                      >
                        Review
                      </a>
                    </div>
                  )}
                </div>
              </li>
            ))
          }
        </ul>
      </section>
    </main>
    <Footer />
  </BaseBody>
</html>
